!function(f,b,c,d){var a=function(h,g){this.elem=h,this.$elem=f(h),this.options=g,this.metadata=this.$elem.data("plugin-options"),this.$win=f(b),this.sections={},this.didScroll=!1,this.$doc=f(c),this.docHeight=this.$doc.height()};a.prototype={defaults:{navItems:"a",currentClass:"current",changeHash:!1,easing:"swing",filter:"",scrollSpeed:750,scrollThreshold:0.5,begin:!1,end:!1,scrollChange:!1},init:function(){return this.config=f.extend({},this.defaults,this.options,this.metadata),this.$nav=this.$elem.find(this.config.navItems),""!==this.config.filter&&(this.$nav=this.$nav.filter(this.config.filter)),this.$nav.on("click.onePageNav",f.proxy(this.handleClick,this)),this.getPositions(),this.bindInterval(),this.$win.on("resize.onePageNav",f.proxy(this.getPositions,this)),this},adjustNav:function(g,e){g.$elem.find("."+g.config.currentClass).removeClass(g.config.currentClass),e.addClass(g.config.currentClass)},bindInterval:function(){var g,e=this;e.$win.on("scroll.onePageNav",function(){e.didScroll=!0}),e.t=setInterval(function(){g=e.$doc.height(),e.didScroll&&(e.didScroll=!1,e.scrollChange()),g!==e.docHeight&&(e.docHeight=g,e.getPositions())},250)},getHash:function(e){return e.attr("href").split("#")[1]},getPositions:function(){var h,j,k,g=this;g.$nav.each(function(){h=g.getHash(f(this)),k=f("#"+h),k.length&&(j=k.offset().top,g.sections[h]=Math.round(j))})},getSection:function(j){var e=null,g=Math.round(this.$win.height()*this.config.scrollThreshold);for(var h in this.sections){this.sections[h]-g<j&&(e=h)}return e},handleClick:function(i){var k=this,h=f(i.currentTarget),j=h.parent(),g="#"+k.getHash(h);j.hasClass(k.config.currentClass)||(k.config.begin&&k.config.begin(),k.adjustNav(k,j),k.unbindInterval(),k.scrollTo(g,function(){k.config.changeHash&&(b.location.hash=g),k.bindInterval(),k.config.end&&k.config.end()})),i.preventDefault()},scrollChange:function(){var h,e=this.$win.scrollTop(),g=this.getSection(e);null!==g&&(h=this.$elem.find('a[href$="#'+g+'"]').parent(),h.hasClass(this.config.currentClass)||(this.adjustNav(this,h),this.config.scrollChange&&this.config.scrollChange(h)))},scrollTo:function(e,g){var h=f(e).offset().top;f("html, body").animate({scrollTop:h-this.config.scrollOffset},this.config.scrollSpeed,this.config.easing,g)},unbindInterval:function(){clearInterval(this.t),this.$win.unbind("scroll.onePageNav")}},a.defaults=a.prototype.defaults,f.fn.onePageNav=function(e){return this.each(function(){new a(this,e).init()})}}(jQuery,window,document);
